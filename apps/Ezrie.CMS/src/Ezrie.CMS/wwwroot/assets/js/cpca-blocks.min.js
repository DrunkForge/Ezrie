Vue.component("accordion-panel-block",{props:["uid","toolbar","model"],data:function(){return{titleId:null,title:this.model.title.value,bodyId:null,body:this.model.body.value,placeholder:{title:null,body:null}}},methods:{onTitleBlur:function(t){this.model.title.value=t.target.innerText;var e=this.model.title.value.replace(/(<([^>]+)>)/gi,"");e.length>40&&(e=e.substring(0,40)+"..."),this.$emit("update-title",{uid:this.uid,title:e})},onBodyBlur:function(t){this.model.body.value=tinyMCE.activeEditor.getContent()},onChange:function(t){console.log(t),'<br data-mce-bogus="1">'!=t&&(this.model.body.value=t)}},computed:{isEmpty:function(){return null==this.model.title.value&&null==this.model.body.value}},created:function(){this.placeholder={title:"Fugit anim consectetuer leo temporibus",body:"Repellat itaque atque sagittis lectus, volutpat necessitatibus praesentium vestibulum atque quidem quaerat sapien. Ex dui aliqua orci dictum integer! est elit. Ipsam numquam. Accumsan explicabo vulputate quam aspernatur platea inventore iure vel ante,"},this.titleId=this.uid+"t",this.bodyId=this.uid+"b"},mounted:function(){piranha.editor.addInline(this.bodyId,this.toolbar,this.onChange)},beforeDestroy:function(){piranha.editor.remove(this.bodyId)},template:'\n<div :id="uid" class="block-body" :class="{ empty: isEmpty }">\n\t<p contenteditable="true" class="panel-title" :id="titleId" v-html="title" v-on:blur="onTitleBlur" :data-placeholder="placeholder.title"></p>\n\t<p contenteditable="true" class="panel-body" :id="bodyId" v-html="body" v-on:blur="onBodyBlur" :data-placeholder="placeholder.body"></p>\n</div>\n'}),Vue.component("card-block",{props:["uid","model"],methods:{onTitleBlur:function(t){this.model.title.value=t.target.innerText},onSubTitleBlur:function(t){this.model.subTitle.value=t.target.innerText},onContentBlur:function(t){this.model.content.value=t.target.innerText},onButtonBlur:function(t){this.model.button.value=t.target.innerText},selectImage:function(){null!=this.model.image.media?piranha.mediapicker.open(this.updateImage,"Image",this.model.image.media.folderId):piranha.mediapicker.openCurrentFolder(this.updateImage,"Image")},removeImage:function(){this.model.image.id=null,this.model.image.media=null},updateImage:function(t){"Image"===t.type&&(this.model.image.id=t.id,this.model.image.media={id:t.id,folderId:t.folderId,type:t.type,filename:t.filename,contentType:t.contentType,publicUrl:t.publicUrl})},selectPage:function(){piranha.pagepicker.open(this.updatePage)},removePage:function(){this.model.link.id=null,this.model.link.page=null},updatePage:function(t){if(null!==t){var e=this;fetch(piranha.baseUrl+"manager/api/page/info/"+t.id).then(function(t){return t.json()}).then(function(t){e.model.link.id=t.id,e.model.link.page=t}).catch(function(t){console.log("error:",t)})}}},computed:{image:function(){return this.hasImage?piranha.baseUrl+"manager/api/media/url/"+this.model.image.media.id+"/1080/720":piranha.utils.formatUrl("~/manager/assets/img/empty-image.png")},hasImage:function(){return null!==this.model.image.page&&null!==this.model.image.media},title:function(){return this.hasTitle?this.model.title.value:"I Need A Title..."},hasTitle:function(){return null!==this.model.title&&!piranha.utils.isEmptyText(this.model.title.value)},subTitle:function(){return this.hasSubTitle?this.model.subTitle.value:"The subTitle is optional."},hasSubTitle:function(){return null!==this.model.subTitle&&!piranha.utils.isEmptyText(this.model.subTitle.value)},content:function(){return this.hasContent?this.model.content.value:"Some random giberish goes here. Maybe a bit of snarkiness as well."},hasContent:function(){return null!==this.model.content&&!piranha.utils.isEmptyText(this.model.content.value)},linkTitle:function(){return this.hasLinkTitle?this.model.link.page.title:""},hasLinkTitle:function(){return null!==this.model.link.page},buttonText:function(){return this.hasButtonText?this.model.button.value:"Click Me!"},hasButtonText:function(){return!piranha.utils.isEmptyText(this.model.button.value)}},mounted:function(){this.model.getTitle=function(){return null!==this.model.link.page?this.model.link.page.title:"No page selected"}},template:'\n<div class="block-body rounded clearfix">\n\t<div>\n\t\t<img class="card-img-top" style="cursor: pointer" v-on:click.prevent="selectImage" :src="image">\n\t\t<div class="card-body">\n\t\t\t<h3 contenteditable="true" class="card-title" :class="{ \'text-secondary\': !hasTitle }" v-html="title" v-on:blur="onTitleBlur"></h3>\n\t\t\t<h5 contenteditable="true" class="card-subtitle" :class="{ \'text-secondary\': !hasSubTitle }" v-html="subTitle" v-on:blur="onSubTitleBlur"></h5>\n\t\t\t<p contenteditable="true" :class="{ \'text-secondary\': !hasContent }" v-html="content" v-on:blur="onContentBlur"></p>\n\t\t\t<div contenteditable="true" class="btn btn-outline-primary" style="cursor: text" v-html="buttonText" v-on:blur="onButtonBlur"></div>\n\t\t\t<div class="row mt-3">\n\t\t\t\t<div class="col">\n\t\t\t\t\t<div class="btn-group">\n\t\t\t\t\t\t<button v-on:click.prevent="selectPage" class="btn btn-primary text-center">\n\t\t\t\t\t\t\t<i class="fas fa-link"></i>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t\t<button v-on:click.prevent="removePage" class="btn btn-danger text-center">\n\t\t\t\t\t\t\t<i class="fas fa-unlink"></i>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t\t<span v-if="hasLinkTitle">\n\t\t\t\t\t\t{{ linkTitle }}\n\t\t\t\t\t</span>\n\t\t\t\t\t<span v-else>\n\t\t\t\t\t\tPlease select a page to link to.\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>\n'}),Vue.component("heading-block",{props:["uid","model"],data:function(){return{placeholder:{heading:null,description:null,alignment:null}}},methods:{onAlignmentChange:function(t){this.model.alignment.value=t.target.value},onHeadingBlur:function(t){this.model.heading.value=t.target.innerText},onDescriptionBlur:function(t){this.model.description.value=t.target.innerText;var e=this.model.heading.value.replace(/(<([^>]+)>)/gi,"");e.length>40&&(e=heading.substring(0,40)+"..."),this.$emit("update-title",{uid:this.uid,title:e})},getAlignment:function(){return 0==this.model.alignment.value?"text-left":2==this.model.alignment.value?"text-right":"text-center"},isSelected:function(t){return t==this.model.alignment.value}},computed:{isEmpty:function(){return null==this.model.heading.value}},created:function(){this.placeholder={heading:"Section Heading",description:"Section Description (Optional)",alignment:1}},template:'\n<div :id="uid" class="block-body">\n\t<div class="row justify-content-end">\n\t\t<div class="col-2 text-right">\n\t\t\t<div class="form-group">\n\t\t\t\t<select class="form-control" v-model="model.alignment.value" v-on:change="onAlignmentChange">\n\t\t\t\t\t<option value="0" :selected="`${isSelected(0)}`">Left</option>\n\t\t\t\t\t<option value="1" :selected="`${isSelected(1)}`">Center</option>\n\t\t\t\t\t<option value="2" :selected="`${isSelected(2)}`">Right</option>\n\t\t\t\t</select>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\t<div class="heading-block">\n\t\t<div :class="`heading ${getAlignment()}`">\n\t\t\t<h2 contenteditable="true" v-html="model.heading.value" v-on:blur="onHeadingBlur" :data-placeholder="placeholder.heading"></h2>\n\t\t\t<p contenteditable="true" v-html="model.description.value" v-on:blur="onDescriptionBlur" :data-placeholder="placeholder.description"></p>\n\t\t</div>\n\t</div>\n</div>\n'}),Vue.component("window-block",{props:["uid","toolbar","model"],data:function(){return{body:this.model.body.value,height:this.model.height.value}},methods:{onBodyBlur:function(t){this.model.body.value=tinyMCE.activeEditor.getContent()},onBodyChange:function(t){this.model.body.value=t},onHeightBlur:function(t){this.model.height.value=t.target.value},onHeightChange:function(t){this.model.height.value=e.target.innerText},selectImage:function(){null!=this.model.image.media?piranha.mediapicker.open(this.updateImage,"Image",this.model.image.media.folderId):piranha.mediapicker.openCurrentFolder(this.updateImage,"Image")},removeImage:function(){this.model.image.id=null,this.model.image.media=null},updateImage:function(t){"Image"===t.type&&(this.model.image.id=t.id,this.model.image.media={id:t.id,folderId:t.folderId,type:t.type,filename:t.filename,contentType:t.contentType,publicUrl:t.publicUrl})}},computed:{isEmpty:function(){return piranha.utils.isEmptyHtml(this.model.body.value)},bgStyle:function(){return this.hasImage?`height: ${this.model.height.value}; background-image:url(${piranha.baseUrl}manager/api/media/url/${this.model.image.media.id}`:`height: ${this.model.height.value}; background-image:url(${piranha.utils.formatUrl("~/manager/assets/img/empty-image.png")})`},image:function(){return this.hasImage?`background-image:url(${piranha.baseUrl}manager/api/media/url/${this.model.image.media.id}/1080/720`:piranha.utils.formatUrl("~/manager/assets/img/empty-image.png")},hasImage:function(){return null!==this.model.image.page&&null!==this.model.image.media}},mounted:function(){piranha.editor.addInline(this.uid,this.toolbar,this.onBodyChange)},beforeDestroy:function(){piranha.editor.remove(this.uid)},template:'\n<div class="block-body" :class="{ empty: isEmpty }">\n\n\t<div class="window-block">\n\t\t<div class="window-block-image bg-fixed" :style="bgStyle">\n\t\t\t<div class="overlay-content" contenteditable="true" :id="uid" v-html="body" v-on:blur="onBodyBlur"></div>\n\t\t</div>\n\t</div>\n\n\t<div class="form-inline my-3">\n\t\t<label class="mx-1">Window Height</label>\n\t\t<input class="form-control mx-1" type="number" v-model="height" v-on:blur="onHeightBlur">\n\t\t<button class="btn btn-primary mx-1" v-on:click.prevent="selectImage"><i class="fas fa-image"></i> Browse</button>\n\t</div>\n\n</div>\n'});